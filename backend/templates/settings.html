{% extends "base.html" %}

{% block title %}Настройки - EKOSYSTEMA_FULL{% endblock %}

{% block header %}Настройки системы{% endblock %}

{% block content %}
<div class="max-w-4xl">
    <!-- API ключи -->
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="p-6 border-b">
            <h3 class="text-lg font-semibold text-gray-900">API ключи и токены</h3>
            <p class="text-sm text-gray-600 mt-1">Настройте подключения к внешним сервисам</p>
        </div>
        <div class="p-6">
            <form id="apiKeysForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-paper-plane mr-2 text-blue-500"></i>
                            Telegram Bot Token
                        </label>
                        <input type="password" id="telegramToken" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz">
                        <p class="text-xs text-gray-500 mt-1">Получить у @BotFather</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-play mr-2 text-red-500"></i>
                            YouTube API Key
                        </label>
                        <input type="password" id="youtubeApiKey"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="AIzaSyA...">
                        <p class="text-xs text-gray-500 mt-1">Google Cloud Console</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-music mr-2 text-black"></i>
                            TikTok API Token
                        </label>
                        <input type="password" id="tiktokToken"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="В разработке"
                               disabled>
                        <p class="text-xs text-gray-500 mt-1">TikTok Developer Portal</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-brain mr-2 text-purple-500"></i>
                            OpenAI API Key
                        </label>
                        <input type="password" id="openaiApiKey"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="sk-...">
                        <p class="text-xs text-gray-500 mt-1">Для генерации текстов (опционально)</p>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-save mr-2"></i>
                        Сохранить API ключи
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Настройки генерации контента -->
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="p-6 border-b">
            <h3 class="text-lg font-semibold text-gray-900">Генерация контента</h3>
            <p class="text-sm text-gray-600 mt-1">Параметры по умолчанию для создания контента</p>
        </div>
        <div class="p-6">
            <form id="contentSettingsForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Длительность видео по умолчанию</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="15">15 секунд</option>
                            <option value="30" selected>30 секунд</option>
                            <option value="60">60 секунд</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Голос для озвучки</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="female" selected>Женский</option>
                            <option value="male">Мужской</option>
                            <option value="neutral">Нейтральный</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Качество видео</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="720p">HD (720p)</option>
                            <option value="1080p" selected>Full HD (1080p)</option>
                            <option value="4k">4K (опционально)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Стиль по умолчанию</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="modern" selected>Современный</option>
                            <option value="minimalist">Минималистичный</option>
                            <option value="dynamic">Динамичный</option>
                            <option value="educational">Обучающий</option>
                        </select>
                    </div>
                </div>
                
                <div class="mt-6 space-y-3">
                    <label class="flex items-center">
                        <input type="checkbox" checked class="rounded">
                        <span class="ml-2 text-sm">Добавлять фоновую музыку автоматически</span>
                    </label>
                    
                    <label class="flex items-center">
                        <input type="checkbox" checked class="rounded">
                        <span class="ml-2 text-sm">Включать партнерские ссылки в описание</span>
                    </label>
                    
                    <label class="flex items-center">
                        <input type="checkbox" class="rounded">
                        <span class="ml-2 text-sm">Автоматически публиковать готовый контент</span>
                    </label>
                    
                    <label class="flex items-center">
                        <input type="checkbox" checked class="rounded">
                        <span class="ml-2 text-sm">Добавлять водяной знак</span>
                    </label>
                </div>
                
                <div class="mt-6">
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-save mr-2"></i>
                        Сохранить настройки контента
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Настройки публикации -->
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="p-6 border-b">
            <h3 class="text-lg font-semibold text-gray-900">Публикация и расписание</h3>
            <p class="text-sm text-gray-600 mt-1">Настройте автоматическую публикацию контента</p>
        </div>
        <div class="p-6">
            <form id="publishingSettingsForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Частота публикаций</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="daily">Ежедневно</option>
                            <option value="3times_week" selected>3 раза в неделю</option>
                            <option value="weekly">Еженедельно</option>
                            <option value="manual">Только вручную</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Время публикации</label>
                        <input type="time" value="18:00" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Часовой пояс</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="UTC+3" selected>Москва (UTC+3)</option>
                            <option value="UTC+0">Лондон (UTC+0)</option>
                            <option value="UTC-5">Нью-Йорк (UTC-5)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Приоритет платформ</label>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                <span class="text-sm">1. TikTok</span>
                                <div class="flex items-center space-x-1">
                                    <button type="button" class="text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button type="button" class="text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                <span class="text-sm">2. YouTube</span>
                                <div class="flex items-center space-x-1">
                                    <button type="button" class="text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button type="button" class="text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 space-y-3">
                    <label class="flex items-center">
                        <input type="checkbox" class="rounded">
                        <span class="ml-2 text-sm">Публиковать в выходные дни</span>
                    </label>
                    
                    <label class="flex items-center">
                        <input type="checkbox" checked class="rounded">
                        <span class="ml-2 text-sm">Уведомлять о публикациях</span>
                    </label>
                    
                    <label class="flex items-center">
                        <input type="checkbox" class="rounded">
                        <span class="ml-2 text-sm">Перепубликовывать популярный контент</span>
                    </label>
                </div>
                
                <div class="mt-6">
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-save mr-2"></i>
                        Сохранить настройки публикации
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Мониторинг трендов -->
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="p-6 border-b">
            <h3 class="text-lg font-semibold text-gray-900">Мониторинг трендов</h3>
            <p class="text-sm text-gray-600 mt-1">Настройте автоматический поиск популярных тем</p>
        </div>
        <div class="p-6">
            <form id="trendsSettingsForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Частота проверки</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="hourly" selected>Каждый час</option>
                            <option value="3hours">Каждые 3 часа</option>
                            <option value="6hours">Каждые 6 часов</option>
                            <option value="daily">Ежедневно</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Регион поиска</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="RU" selected>Россия</option>
                            <option value="US">США</option>
                            <option value="Global">Глобально</option>
                        </select>
                    </div>
                </div>
                
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ключевые слова для мониторинга</label>
                    <textarea rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
                              placeholder="telegram, подарки, боты, бесплатно, криптовалюта, заработок">telegram, подарки, боты, бесплатно, криптовалюта, заработок</textarea>
                    <p class="text-xs text-gray-500 mt-1">Разделяйте ключевые слова запятыми</p>
                </div>
                
                <div class="mt-6 space-y-3">
                    <label class="flex items-center">
                        <input type="checkbox" checked class="rounded">
                        <span class="ml-2 text-sm">Включить мониторинг трендов</span>
                    </label>
                    
                    <label class="flex items-center">
                        <input type="checkbox" checked class="rounded">
                        <span class="ml-2 text-sm">Автоматически создавать контент по трендам</span>
                    </label>
                    
                    <label class="flex items-center">
                        <input type="checkbox" class="rounded">
                        <span class="ml-2 text-sm">Уведомлять о новых трендах</span>
                    </label>
                </div>
                
                <div class="mt-6">
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-save mr-2"></i>
                        Сохранить настройки мониторинга
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Системная информация -->
    <div class="bg-white rounded-lg shadow">
        <div class="p-6 border-b">
            <h3 class="text-lg font-semibold text-gray-900">Системная информация</h3>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <h4 class="font-medium text-gray-900 mb-2">Версия системы</h4>
                    <p class="text-sm text-gray-600">EKOSYSTEMA_FULL v1.0.0</p>
                    <p class="text-xs text-gray-500 mt-1">Последнее обновление: 03.08.2025</p>
                </div>
                
                <div>
                    <h4 class="font-medium text-gray-900 mb-2">Использование диска</h4>
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-1">
                        <div class="bg-blue-600 h-2 rounded-full" style="width: 35%"></div>
                    </div>
                    <p class="text-sm text-gray-600">105 ГБ из 300 ГБ</p>
                </div>
                
                <div>
                    <h4 class="font-medium text-gray-900 mb-2">Статус служб</h4>
                    <div class="space-y-1">
                        <div class="flex items-center justify-between text-sm">
                            <span>FastAPI</span>
                            <span class="text-green-600">●</span>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span>MongoDB</span>
                            <span class="text-green-600">●</span>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span>Dashboard</span>
                            <span class="text-green-600">●</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 pt-6 border-t flex space-x-3">
                <button onclick="exportSettings()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-download mr-2"></i>
                    Экспорт настроек
                </button>
                
                <button onclick="importSettings()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-upload mr-2"></i>
                    Импорт настроек
                </button>
                
                <button onclick="resetSettings()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                    <i class="fas fa-undo mr-2"></i>
                    Сброс к заводским
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Сохранение API ключей
    document.getElementById('apiKeysForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const apiKeys = {
            telegram_token: document.getElementById('telegramToken').value,
            youtube_api_key: document.getElementById('youtubeApiKey').value,
            tiktok_token: document.getElementById('tiktokToken').value,
            openai_api_key: document.getElementById('openaiApiKey').value
        };
        
        // Здесь будет API вызов для сохранения ключей
        showNotification('API ключи сохранены', 'success');
    });
    
    // Сохранение настроек контента
    document.getElementById('contentSettingsForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        showNotification('Настройки генерации контента сохранены', 'success');
    });
    
    // Сохранение настроек публикации
    document.getElementById('publishingSettingsForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        showNotification('Настройки публикации сохранены', 'success');
    });
    
    // Сохранение настроек мониторинга
    document.getElementById('trendsSettingsForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        showNotification('Настройки мониторинга трендов сохранены', 'success');
    });
    
    function exportSettings() {
        // Экспорт настроек в JSON
        const settings = {
            // Здесь будут все настройки системы
        };
        
        const dataStr = JSON.stringify(settings, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = 'ekosystema_settings.json';
        link.click();
        
        showNotification('Настройки экспортированы', 'success');
    }
    
    function importSettings() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        
        input.onchange = function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const settings = JSON.parse(e.target.result);
                        // Здесь будет применение импортированных настроек
                        showNotification('Настройки импортированы успешно', 'success');
                    } catch (error) {
                        showNotification('Ошибка при импорте настроек', 'error');
                    }
                };
                reader.readAsText(file);
            }
        };
        
        input.click();
    }
    
    function resetSettings() {
        if (confirm('Вы уверены, что хотите сбросить все настройки к заводским значениям?')) {
            // Здесь будет сброс настроек
            showNotification('Настройки сброшены к заводским значениям', 'info');
            setTimeout(() => {
                location.reload();
            }, 2000);
        }
    }
</script>
{% endblock %}